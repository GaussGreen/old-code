
#ifndef _F1_HERMITEINTEGRATION_H_
#define _F1_HERMITEINTEGRATION_H_

#include "icm_functors.h"
#include <float.h>
#include <math.h>
#include <string>
// Compute integral
//     /- +inf
//	  / 
//   /    f(x) exp(-x²)dx
//  /
//-/-inf
// with an hermite approximation at degree 20

template <class F> class HermiteIntegration_t
{
public:
	HermiteIntegration_t(F f):m_f(f){}
	virtual ~HermiteIntegration_t() {}
	double Integrate(const int& nb);
	double Integrate_20();
	double Integrate_40();
	double Integrate_60();
	double Integrate_100();
	
	static bool test(std::string& errStr);
private :
	F		m_f; 
	static double HermiteCoeff[20][2];
	static double HermiteCoeff_40[40][2];
	static double HermiteCoeff_60[60][2];
	static double HermiteCoeff_100[100][2];
};
//----------------------------------------------------------------------------
//	Helper. 
template <class F> inline HermiteIntegration_t<F> HermiteIntegration(F f)
{ return HermiteIntegration_t<F>(f) ; }
//----------------------------------------------------------------------------
template <class F> double HermiteIntegration_t<F>::HermiteCoeff[20][2] = { 
						{0.2453407083009 , 4.622436696006*pow(10.,-1)},
						{0.7374737285454 , 2.866755053628*pow(10.,-1)},
						{1.2340762153953 , 1.090172060200*pow(10.,-1)},
						{1.7385377121166 , 2.481052088746*pow(10.,-2)},
						{2.2549740020893 , 3.243773342238*pow(10.,-3)},
						{2.7888060584281 , 2.283386360163*pow(10.,-4)},
						{3.3478545673832 , 7.802556478532*pow(10.,-6)},
						{3.9447640401156 , 1.086069370769*pow(10.,-7)},
						{4.6036824495507 , 4.399340992273*pow(10.,-10)},
						{5.3874808900112 , 2.229393645534*pow(10.,-13)},
						{-0.2453407083009 , 4.622436696006*pow(10.,-1)},
						{-0.7374737285454 , 2.866755053628*pow(10.,-1)},
						{-1.2340762153953 , 1.090172060200*pow(10.,-1)},
						{-1.7385377121166 , 2.481052088746*pow(10.,-2)},
						{-2.2549740020893 , 3.243773342238*pow(10.,-3)},
						{-2.7888060584281 , 2.283386360163*pow(10.,-4)},
						{-3.3478545673832 , 7.802556478532*pow(10.,-6)},
						{-3.9447640401156 , 1.086069370769*pow(10.,-7)},
						{-4.6036824495507 , 4.399340992273*pow(10.,-10)},
						{-5.3874808900112 , 2.229393645534*pow(10.,-13)} };
//----------------------------------------------------------------------------
template <class F>
double
HermiteIntegration_t<F>::Integrate_20()
{
	double ret(0.);
	for(int i=0;i<20;i++) ret += m_f(HermiteCoeff[i][0])*HermiteCoeff[i][1];
	return ret;
}
//----------------------------------------------------------------------------
// For test purpose
class A {
	public: 
	A(){};
	~A(){};
	double f(double) {return 1.;}
};
//----------------------------------------------------------------------------

template <class F>
bool
HermiteIntegration_t<F>::test(std::string& errStr)
{
	bool ret(true);
	
	errStr = "Testing HermiteIntegration";

	A a;
	double val = HermiteIntegration_t(ff1::mem_call(&A::f, a)).Integrate();	
//	SDMTEST((val>1.77245385)&&(val<1.77245386))

	return ret;
}

//----------------------------------------------------------------------------
template <class F> double HermiteIntegration_t<F>::HermiteCoeff_40[40][2] = { 
						{8.098761139250850000 ,	2.59104371384705*pow(10.,-29)},
						{7.411582531485470000 ,	8.5440569637755*pow(10.,-25)},
						{6.840237305249360000 ,	2.56759336541128*pow(10.,-21)},
						{6.328255351220080000 ,	1.9891810121165*pow(10.,-18)},
						{5.854095056030400000 ,	6.00835878949085*pow(10.,-16)},
						{5.406654247970130000 ,	8.80570764520832*pow(10.,-14)},
						{4.979260978545260000 ,	7.15652805269036*pow(10.,-12)},
						{4.567502072844390000 ,	3.52562079136542*pow(10.,-10)},
						{4.168257066832500000 ,	1.12123608322758*pow(10.,-8)},
						{3.779206753435220000 ,	2.41114416367053*pow(10.,-7)},
						{3.398558265859630000 ,	3.63157615069302*pow(10.,-6)},
						{3.024879883901280000 ,	3.93693398109166*pow(10.,-5)},
						{2.656995998442900000 ,	3.13853594541326*pow(10.,-4)},
						{2.293917141875080000 ,	1.87149682959795*pow(10.,-3)},
						{1.934791472282300000 ,	8.46088800825813*pow(10.,-3)},
						{1.578869894931610000 ,	2.93125655361724*pow(10.,-2)},
						{1.225480109046290000 ,	7.84746058654044*pow(10.,-2)},
						{0.874006612357088000 ,	1.63378732713271*pow(10.,-1)},
						{0.523874713832277000 ,	2.65728251877377*pow(10.,-1)},
						{0.174537214597582000 ,	3.38643277425588*pow(10.,-1)},
						{-0.174537214597582000 , 3.38643277425588*pow(10.,-1)},
						{-0.523874713832277000 , 2.65728251877377*pow(10.,-1)},
						{-0.874006612357088000 , 1.63378732713271*pow(10.,-1)},
						{-1.225480109046290000 , 7.84746058654044*pow(10.,-2)},
						{-1.578869894931610000 , 2.93125655361724*pow(10.,-2)},
						{-1.934791472282300000 , 8.46088800825813*pow(10.,-3)},
						{-2.293917141875080000 , 1.87149682959795*pow(10.,-3)},
						{-2.656995998442900000 , 3.13853594541326*pow(10.,-4)},
						{-3.024879883901280000 , 3.93693398109166*pow(10.,-5)},
						{-3.398558265859630000 , 3.63157615069302*pow(10.,-6)},
						{-3.779206753435220000 , 2.41114416367053*pow(10.,-7)},
						{-4.168257066832500000 , 1.12123608322758*pow(10.,-8)},
						{-4.567502072844390000 , 3.52562079136542*pow(10.,-10)},
						{-4.979260978545260000 , 7.15652805269036*pow(10.,-12)},
						{-5.406654247970130000 , 8.80570764520832*pow(10.,-14)},
						{-5.854095056030400000 , 6.00835878949085*pow(10.,-16)},
						{-6.328255351220080000 , 1.9891810121165*pow(10.,-18)},
						{-6.840237305249360000 , 2.56759336541128*pow(10.,-21)},
						{-7.411582531485470000 , 8.5440569637755*pow(10.,-25)},
						{-8.098761139250850000 , 2.59104371384705*pow(10.,-29)} };
//----------------------------------------------------------------------------
template <class F>
double
HermiteIntegration_t<F>::Integrate_40()
{
	double ret(0.);
	for(int i=0;i<40;i++) ret += m_f(HermiteCoeff_40[i][0])*HermiteCoeff_40[i][1];
	return ret;
}
//----------------------------------------------------------------------------


//----------------------------------------------------------------------------
template <class F> double HermiteIntegration_t<F>::HermiteCoeff_60[60][2] = { 
{10.159109246180087000, 0.000000000000000000000000000000000000000000001109587247968328},
{9.520903677013318900, 0.000000000000000000000000000000000000000243974758814514790000},
{8.992398001404945200, 0.000000000000000000000000000000000003771626727120650400000000},
{8.520569284117630800, 0.000000000000000000000000000000013325596117642568000000000000},
{8.085188654249021700, 0.000000000000000000000000000017155731476717432000000000000000},
{7.675839937504887800, 0.000000000000000000000000010294059971650847000000000000000000},
{7.286276594395599400, 0.000000000000000000000003345756955750121700000000000000000000},
{6.912381532189319200, 0.000000000000000000000651256725749631000000000000000000000000},
{6.551259167062920800, 0.000000000000000000081536404730238705000000000000000000000000},
{6.200773557993438000, 0.000000000000000006923247909577586000000000000000000000000000},
{5.859290196394234800, 0.000000000000000415244410969402680000000000000000000000000000},
{5.525521086138684100, 0.000000000000018166245762596378000000000000000000000000000000},
{5.198426534576293900, 0.000000000000594843051605606910000000000000000000000000000000},
{4.877150077473150900, 0.000000000014889573490628114000000000000000000000000000000000},
{4.560973757935835600, 0.000000000289935901280645800000000000000000000000000000000000},
{4.249286435956006100, 0.000000004456822775225575400000000000000000000000000000000000},
{3.941560733926184700, 0.000000054755546192765976000000000000000000000000000000000000},
{3.637335876170731700, 0.000000543351613420487990000000000000000000000000000000000000},
{3.336204653547587100, 0.000004394286936267034400000000000000000000000000000000000000},
{3.037803338230749400, 0.000029187419041555304000000000000000000000000000000000000000},
{2.741803748069692000, 0.000160277334681844690000000000000000000000000000000000000000},
{2.447906902307685600, 0.000731773556965508890000000000000000000000000000000000000000},
{2.155837871229211000, 0.002791324828953062000000000000000000000000000000000000000000},
{1.865341531233031700, 0.008932178360307794700000000000000000000000000000000000000000},
{1.576179011975020300, 0.024061272766109375000000000000000000000000000000000000000000},
{1.288124674868893700, 0.054718970932182830000000000000000000000000000000000000000000},
{1.000963499560718000, 0.105298763697785640000000000000000000000000000000000000000000},
{0.714488781672578570, 0.171776156918885290000000000000000000000000000000000000000000},
{0.428500064220627530, 0.237868904958657060000000000000000000000000000000000000000000},
{0.142801238703438860, 0.279853117522829150000000000000000000000000000000000000000000},
{-0.142801238703438860, 0.279853117522829150000000000000000000000000000000000000000000},
{-0.428500064220627530, 0.237868904958657060000000000000000000000000000000000000000000},
{-0.714488781672578570, 0.171776156918885290000000000000000000000000000000000000000000},
{-1.000963499560718000, 0.105298763697785640000000000000000000000000000000000000000000},
{-1.288124674868893700, 0.054718970932182830000000000000000000000000000000000000000000},
{-1.576179011975020300, 0.024061272766109375000000000000000000000000000000000000000000},
{-1.865341531233031700, 0.008932178360307794700000000000000000000000000000000000000000},
{-2.155837871229211000, 0.002791324828953062000000000000000000000000000000000000000000},
{-2.447906902307685600, 0.000731773556965508890000000000000000000000000000000000000000},
{-2.741803748069692000, 0.000160277334681844690000000000000000000000000000000000000000},
{-3.037803338230749400, 0.000029187419041555304000000000000000000000000000000000000000},
{-3.336204653547587100, 0.000004394286936267034400000000000000000000000000000000000000},
{-3.637335876170731700, 0.000000543351613420487990000000000000000000000000000000000000},
{-3.941560733926184700, 0.000000054755546192765976000000000000000000000000000000000000},
{-4.249286435956006100, 0.000000004456822775225575400000000000000000000000000000000000},
{-4.560973757935835600, 0.000000000289935901280645800000000000000000000000000000000000},
{-4.877150077473150900, 0.000000000014889573490628114000000000000000000000000000000000},
{-5.198426534576293900, 0.000000000000594843051605606910000000000000000000000000000000},
{-5.525521086138684100, 0.000000000000018166245762596378000000000000000000000000000000},
{-5.859290196394234800, 0.000000000000000415244410969402680000000000000000000000000000},
{-6.200773557993438000, 0.000000000000000006923247909577586000000000000000000000000000},
{-6.551259167062920800, 0.000000000000000000081536404730238705000000000000000000000000},
{-6.912381532189319200, 0.000000000000000000000651256725749631000000000000000000000000},
{-7.286276594395599400, 0.000000000000000000000003345756955750121700000000000000000000},
{-7.675839937504887800, 0.000000000000000000000000010294059971650847000000000000000000},
{-8.085188654249021700, 0.000000000000000000000000000017155731476717432000000000000000},
{-8.520569284117630800, 0.000000000000000000000000000000013325596117642568000000000000},
{-8.992398001404945200, 0.000000000000000000000000000000000003771626727120650400000000},
{-9.520903677013318900, 0.000000000000000000000000000000000000000243974758814514790000},
{-10.159109246180087000, 0.000000000000000000000000000000000000000000001109587247968328} };
//----------------------------------------------------------------------------
template <class F>
double
HermiteIntegration_t<F>::Integrate_60()
{
	double ret(0.);
	for(int i=0;i<60;i++) ret += m_f(HermiteCoeff_60[i][0])*HermiteCoeff_60[i][1];
	return ret;
}
//----------------------------------------------------------------------------
template <class F> double HermiteIntegration_t<F>::HermiteCoeff_100[100][2] = { 
{13.406487338144910000, 0.00000000000000000000000000000000000000000000000000000000000000000000000000000059},
{12.823799749487808000, 0.00000000000000000000000000000000000000000000000000000000000000000000000197286057},
{12.342964222859674000, 0.00000000000000000000000000000000000000000000000000000000000000000030830289900033},
{11.915061943114166000, 0.00000000000000000000000000000000000000000000000000000000000000901922230369339050},
{11.521415400787031000, 0.00000000000000000000000000000000000000000000000000000000008518883081761984900000},
{11.152404385585125000, 0.00000000000000000000000000000000000000000000000000000034594779364755260000000000},
{10.802260753684715000, 0.00000000000000000000000000000000000000000000000000071915294634632665000000000000},
{10.467185421342812000, 0.00000000000000000000000000000000000000000000000085975639548253439000000000000000},
{10.144509941292846000, 0.00000000000000000000000000000000000000000000064207252053479634000000000000000000},
{9.832269807777969100, 0.00000000000000000000000000000000000000000031852178778359182000000000000000000000},
{9.528965823390114700, 0.00000000000000000000000000000000000000011004706827142342000000000000000000000000},
{9.233420890219161200, 0.00000000000000000000000000000000000002748784884357155300000000000000000000000000},
{8.944689217325475300, 0.00000000000000000000000000000000000511623260438509190000000000000000000000000000},
{8.661996168134518100, 0.00000000000000000000000000000000072745725968877021000000000000000000000000000000},
{8.384696940416265700, 0.00000000000000000000000000000008067434278709176700000000000000000000000000000000},
{8.112247311162791500, 0.00000000000000000000000000000710181222638504120000000000000000000000000000000000},
{7.844182384460821400, 0.00000000000000000000000000050377911662131548000000000000000000000000000000000000},
{7.580100807857489200, 0.00000000000000000000000002917350072629308600000000000000000000000000000000000000},
{7.319652822304535200, 0.00000000000000000000000139484152606877570000000000000000000000000000000000000000},
{7.062531060248865300, 0.00000000000000000000005561026961656658900000000000000000000000000000000000000000},
{6.808463352858796100, 0.00000000000000000000186499767512994240000000000000000000000000000000000000000000},
{6.557207031921539200, 0.00000000000000000005302316183131498900000000000000000000000000000000000000000000},
{6.308544361112135200, 0.00000000000000000128683292112111880000000000000000000000000000000000000000000000},
{6.062278832614302900, 0.00000000000000002682492164760350000000000000000000000000000000000000000000000000},
{5.818232135203516900, 0.00000000000000048298353217030393000000000000000000000000000000000000000000000000},
{5.576241649329924500, 0.00000000000000754889687791515560000000000000000000000000000000000000000000000000},
{5.336158360138360200, 0.00000000000010288749373509974000000000000000000000000000000000000000000000000000},
{5.097845105089136000, 0.00000000000122787851441013390000000000000000000000000000000000000000000000000000},
{4.861175091791210400, 0.00000000001287903825731550000000000000000000000000000000000000000000000000000000},
{4.626030635787155500, 0.00000000011913006349290783000000000000000000000000000000000000000000000000000000},
{4.392302078682684300, 0.00000000097479212538715502000000000000000000000000000000000000000000000000000000},
{4.159886855131031100, 0.00000000707585728388962940000000000000000000000000000000000000000000000000000000},
{3.928688683427671100, 0.00000004568127508484923800000000000000000000000000000000000000000000000000000000},
{3.698616859318491800, 0.00000026290974837537255000000000000000000000000000000000000000000000000000000000},
{3.469585636418589300, 0.00000135179715911036090000000000000000000000000000000000000000000000000000000000},
{3.241513679631013100, 0.00000622152481777785260000000000000000000000000000000000000000000000000000000000},
{3.014323580331155700, 0.00002567615938454894400000000000000000000000000000000000000000000000000000000000},
{2.787941423981989500, 0.00009517162778550997900000000000000000000000000000000000000000000000000000000000},
{2.562296402372608000, 0.00031729197104330093000000000000000000000000000000000000000000000000000000000000},
{2.337320463906878800, 0.00095269218854862137000000000000000000000000000000000000000000000000000000000000},
{2.112947996371187900, 0.00257927326005908930000000000000000000000000000000000000000000000000000000000000},
{1.889115537427008300, 0.00630300028560804890000000000000000000000000000000000000000000000000000000000000},
{1.665761508741509400, 0.01391566522023183200000000000000000000000000000000000000000000000000000000000000},
{1.442825970215932700, 0.02777912738593350800000000000000000000000000000000000000000000000000000000000000},
{1.220250391218953100, 0.05017581267742866900000000000000000000000000000000000000000000000000000000000000},
{0.997977436098105300, 0.08205182739122166000000000000000000000000000000000000000000000000000000000000000},
{0.775950761540145750, 0.12153798684410347000000000000000000000000000000000000000000000000000000000000000},
{0.554114823591617010, 0.16313003050278285000000000000000000000000000000000000000000000000000000000000000},
{0.332414692342231810, 0.19846285025418642000000000000000000000000000000000000000000000000000000000000000},
{0.110795872422439520, 0.21889262958743905000000000000000000000000000000000000000000000000000000000000000},
{-0.110795872422439520, 0.21889262958743905000000000000000000000000000000000000000000000000000000000000000},
{-0.332414692342231810, 0.19846285025418642000000000000000000000000000000000000000000000000000000000000000},
{-0.554114823591617010, 0.16313003050278285000000000000000000000000000000000000000000000000000000000000000},
{-0.775950761540145750, 0.12153798684410347000000000000000000000000000000000000000000000000000000000000000},
{-0.997977436098105300, 0.08205182739122166000000000000000000000000000000000000000000000000000000000000000},
{-1.220250391218953100, 0.05017581267742866900000000000000000000000000000000000000000000000000000000000000},
{-1.442825970215932700, 0.02777912738593350800000000000000000000000000000000000000000000000000000000000000},
{-1.665761508741509400, 0.01391566522023183200000000000000000000000000000000000000000000000000000000000000},
{-1.889115537427008300, 0.00630300028560804890000000000000000000000000000000000000000000000000000000000000},
{-2.112947996371187900, 0.00257927326005908930000000000000000000000000000000000000000000000000000000000000},
{-2.337320463906878800, 0.00095269218854862137000000000000000000000000000000000000000000000000000000000000},
{-2.562296402372608000, 0.00031729197104330093000000000000000000000000000000000000000000000000000000000000},
{-2.787941423981989500, 0.00009517162778550997900000000000000000000000000000000000000000000000000000000000},
{-3.014323580331155700, 0.00002567615938454894400000000000000000000000000000000000000000000000000000000000},
{-3.241513679631013100, 0.00000622152481777785260000000000000000000000000000000000000000000000000000000000},
{-3.469585636418589300, 0.00000135179715911036090000000000000000000000000000000000000000000000000000000000},
{-3.698616859318491800, 0.00000026290974837537255000000000000000000000000000000000000000000000000000000000},
{-3.928688683427671100, 0.00000004568127508484923800000000000000000000000000000000000000000000000000000000},
{-4.159886855131031100, 0.00000000707585728388962940000000000000000000000000000000000000000000000000000000},
{-4.392302078682684300, 0.00000000097479212538715502000000000000000000000000000000000000000000000000000000},
{-4.626030635787155500, 0.00000000011913006349290783000000000000000000000000000000000000000000000000000000},
{-4.861175091791210400, 0.00000000001287903825731550000000000000000000000000000000000000000000000000000000},
{-5.097845105089136000, 0.00000000000122787851441013390000000000000000000000000000000000000000000000000000},
{-5.336158360138360200, 0.00000000000010288749373509974000000000000000000000000000000000000000000000000000},
{-5.576241649329924500, 0.00000000000000754889687791515560000000000000000000000000000000000000000000000000},
{-5.818232135203516900, 0.00000000000000048298353217030393000000000000000000000000000000000000000000000000},
{-6.062278832614302900, 0.00000000000000002682492164760350000000000000000000000000000000000000000000000000},
{-6.308544361112135200, 0.00000000000000000128683292112111880000000000000000000000000000000000000000000000},
{-6.557207031921539200, 0.00000000000000000005302316183131498900000000000000000000000000000000000000000000},
{-6.808463352858796100, 0.00000000000000000000186499767512994240000000000000000000000000000000000000000000},
{-7.062531060248865300, 0.00000000000000000000005561026961656658900000000000000000000000000000000000000000},
{-7.319652822304535200, 0.00000000000000000000000139484152606877570000000000000000000000000000000000000000},
{-7.580100807857489200, 0.00000000000000000000000002917350072629308600000000000000000000000000000000000000},
{-7.844182384460821400, 0.00000000000000000000000000050377911662131548000000000000000000000000000000000000},
{-8.112247311162791500, 0.00000000000000000000000000000710181222638504120000000000000000000000000000000000},
{-8.384696940416265700, 0.00000000000000000000000000000008067434278709176700000000000000000000000000000000},
{-8.661996168134518100, 0.00000000000000000000000000000000072745725968877021000000000000000000000000000000},
{-8.944689217325475300, 0.00000000000000000000000000000000000511623260438509190000000000000000000000000000},
{-9.233420890219161200, 0.00000000000000000000000000000000000002748784884357155300000000000000000000000000},
{-9.528965823390114700, 0.00000000000000000000000000000000000000011004706827142342000000000000000000000000},
{-9.832269807777969100, 0.00000000000000000000000000000000000000000031852178778359182000000000000000000000},
{-10.144509941292846000, 0.00000000000000000000000000000000000000000000064207252053479634000000000000000000},
{-10.467185421342812000, 0.00000000000000000000000000000000000000000000000085975639548253439000000000000000},
{-10.802260753684715000, 0.00000000000000000000000000000000000000000000000000071915294634632665000000000000},
{-11.152404385585125000, 0.00000000000000000000000000000000000000000000000000000034594779364755260000000000},
{-11.521415400787031000, 0.00000000000000000000000000000000000000000000000000000000008518883081761984900000},
{-11.915061943114166000, 0.00000000000000000000000000000000000000000000000000000000000000901922230369339050},
{-12.342964222859674000, 0.00000000000000000000000000000000000000000000000000000000000000000030830289900033},
{-12.823799749487808000, 0.00000000000000000000000000000000000000000000000000000000000000000000000197286057},
{-13.406487338144910000, 0.00000000000000000000000000000000000000000000000000000000000000000000000000000059} };
//----------------------------------------------------------------------------
template <class F>
double
HermiteIntegration_t<F>::Integrate_100()
{
	double ret(0.);
	for(int i=0;i<100;i++) ret += m_f(HermiteCoeff_100[i][0])*HermiteCoeff_100[i][1];
	return ret;
}


template <class F>
double
HermiteIntegration_t<F>::Integrate(const int& nb)
{
	switch (nb) 
	{
	case 20 :
		return Integrate_20();
	case 40 :
		return Integrate_40();
	case 60 :
		return Integrate_60();
	case 100 :
	default:
		return Integrate_100();
	}

	return (0);
}


#endif	// _F1_HERMITEINTEGRATION_H_


